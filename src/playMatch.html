<html>
<head>
	<meta name = "viewport" content = "width=device-width">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
	<script type="text/javascript">
	    var {{p1}}_AI = JSON.parse("{{p1_AI}}".replace(/&quot;/g,'"'));
        var {{p2}}_AI = JSON.parse("{{p2_AI}}".replace(/&quot;/g,'"'));
		var matches = JSON.parse("{{ matches }}".replace(/&quot;/g,'"'));

        var currentRound = 0;    
        // alert("blah");
		
		function createMiniBoard(board,st,loc) {
			var miniBoard = $("<div style='width:100px; float:left; margin:2px 5px 15px 2px;  '></div>"); 
			$(miniBoard).append("<div style='font-size:14px; font-family:Helvetica'>"+st+"</div>");
			var boardDiv = $("<div style='border:1px solid #aaa;'></div>");
				$(board).each( function(ir,r) {
					//alert(r);
					var row = $("<div style='height:30px; font-size:15px;'></div>");
					$(r).each( function(ic,c) {
						var col = $("<div style='float:left; width:30px; height:30px; border:1px solid #eee;'>"+c+"</div>");
						if (loc!=undefined && loc[0]==ir && loc[1]==ic) {
							//$(col).css('background-color:#ddd');
							if (c=='{{p1}}') $(col).css("background-color","blue");
							else  $(col).css("background-color","red");
							if (st=='takeWin') {
								if (c=='{{p1}}') $(boardDiv).css('border','2px solid blue');
								else $(boardDiv).css('border','2px solid red');
							} else {
							     $(boardDiv).css('border','2px solid white');
							}
						}
						
						$(row).append(col);
					});
					$(row).append("<div style='clear:both'></div>");
					$(boardDiv).append(row);
				});
			$(boardDiv).append("<div style='clear:both'></div>");
			$(miniBoard).append(boardDiv);
			$(miniBoard).append("<div style='clear:both;'></div>");
			return miniBoard;
		}
		
		function showMatchesAsList(matchList) {
		    $("#container").empty();
            $(matchList).each( function(i,m) {
                //alert(e.message);
                var matchDIV = $("<div style='clear:both; margin:10px 0 10px 0; border-top:2px dotted'></div>");
                $(matchDIV).append("<div> Winner : "+ m.winner + "</div>");
                $(m.history).each(function(bi,turn) {
                    var matchBoard = createMiniBoard(turn.board,turn.message,turn.loc);
                    $(matchDIV).append(matchBoard);
                });
                $(matchDIV).append("<div style='clear:both'/>");
                $("#container").append(matchDIV);
            });
		}
		function showMatchesAsAnimation(matchList) {
		  $("#container").empty();
		  $("#container").append("<div><input type='button' value='<' onclick='prev();'/><input type='button' value='>' onclick='next();'/>"+currentRound+"</div>");
		  $(matchList).each( function(i,m) {
		      var matchDIV = $("<div style='float:left'></div>");
		      matchDIV.append("<div style='font-size:13px;'>match "+i+"</div>");
		      var turn = m.history[currentRound];
		      if (turn==undefined) turn=m.history[m.history.length-1];
		      var matchBoard = createMiniBoard(turn.board, turn.message, turn.loc);
		      $(matchDIV).append(matchBoard);
		      $("#container").append(matchDIV);
		  });
		}
		function prev() {
		  currentRound -=1; 
		  if (currentRound<0)  currentRound=0;
		  showMatchesAsAnimation(matches);
		}
		function next() {
          currentRound +=1; 
          if (currentRound>8)  currentRound=8;
          showMatchesAsAnimation(matches);
		}
		
		
		$(document).ready( function() {
			$("#desc").append("<div> {{p1}} : " + {{p1}}_AI +"</div>");
			$("#desc").append("<div> {{p2}} : " + {{p2}}_AI +"</div>");
			$("#desc").append("<div> RESULT : {{winners}} </div>");
			
		    //showMatchesAsList(matches);
		
		});
	
	</script>
	<style>
		.miniBoard {
			height:30px;
			width:30px;
			border: 1px solid #ddd;
		}
	
	</style>
</head>
<body>
	Match result between {{p1}} and {{p2}}
	<div id='desc'></div>
	<div>  
	   <input type="button" onclick="showMatchesAsList(matches)" value="Show Matches as a List"/>
	   <input type="button" onclick="showMatchesAsAnimation(matches)" value="Show Matches as a Animation"/>
	
	</div>
	
	<div id='container'></div>



</body>

</html>
	